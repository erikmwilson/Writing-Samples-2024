

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installing and Configuring Magnum &mdash; Rackspace Private Cloud 14.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/privatecloud.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'14.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: ''
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../_static/bespoke.css" type="text/css" />
  <link rel="stylesheet" href="../_static/bolditalic.css" type="text/css" />
    <link rel="next" title="High availability clusters" href="ha.html" />
    <link rel="prev" title="Magnum Centralized Logging" href="logging.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Rackspace Private Cloud
          

          
            
            <img src="../_static/privatecloud.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                r14-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Rackspace Private Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-faq-external/index.html">Technical FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-ironic/index.html">Bare Metal Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-appformix-external/index.html">Optimization and Visualization User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-releasenotes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-swift/index.html">Stand-alone Object Storage for RPCO Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Internal documents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../rpc-faq-internal/index.html">Technical FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-install-internal/index.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Magnum Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api.html">Magnum API</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Magnum Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="cluster_templates.html">Cluster Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="cluster_certs.html">Cluster certificates</a></li>
<li class="toctree-l2"><a class="reference internal" href="cluster_operations.html">Cluster operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_environment.html">Creating a Devstack Magnum Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Magnum Centralized Logging</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Installing and Configuring Magnum</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#openstack-services">Openstack Services</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#during-rpc-setup">During RPC Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#after-rpc-setup">After RPC Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-a-driver">Installing a Driver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#verification">Verification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ha.html">High availability clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html">Magnum monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="pv.html">Persistent Volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_lb.html">External load balancers</a></li>
<li class="toctree-l2"><a class="reference internal" href="stats.html">Magnum statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker_registry.html">Private Docker registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting Magnum</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-monitoring-internal/index.html">Monitoring and Logging Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-ops-internal/index.html">Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-sales-eng-internal/index.html">Rackspace Private Cloud Sales Engineering Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-upgrade-exp/index.html">Upgrade Expectations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc-upgrade-internal/index.html">Upgrade Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Rackspace Private Cloud</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Magnum Guide</a> &raquo;</li>
        
      <li>Installing and Configuring Magnum</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/rpc-magnum/magnum_setup.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installing-and-configuring-magnum">
<h1>Installing and Configuring Magnum<a class="headerlink" href="#installing-and-configuring-magnum" title="Permalink to this headline">#</a></h1>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">#</a></h2>
<div class="section" id="openstack-services">
<h3>Openstack Services<a class="headerlink" href="#openstack-services" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li>Nova</li>
<li>Glance</li>
<li>Neutron</li>
<li><strong>Neutron LBaaS v2</strong></li>
<li>Cinder</li>
<li>Heat</li>
</ul>
<p><em>must be Mitaka or above</em></p>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h2>
<div class="section" id="during-rpc-setup">
<h3>During RPC Setup<a class="headerlink" href="#during-rpc-setup" title="Permalink to this headline">#</a></h3>
<p>Magnum installation has been integrated into RPC, so you can install
Magnum by setting the DEPLOY_MAGNUM environment variable to &#8216;yes&#8217;
before running &#8216;deploy.sh&#8217;.</p>
</div>
<div class="section" id="after-rpc-setup">
<h3>After RPC Setup<a class="headerlink" href="#after-rpc-setup" title="Permalink to this headline">#</a></h3>
<p>In order to set up Magnum after RPC has already been created, you will
need to add the Magnum configuration variables to the appropriate
Openstack Ansible files, as well as re-running several of the playbooks.
First, you will need to set the following Environment Variables:</p>
<p>OA_DIR</p>
<p>CONTRIB_DIR</p>
<p>The values for these should match the values in &#8216;deploy.sh&#8217; After you
have done so, you can run the &#8216;magnum.sh&#8217; script in
/opt/rpc-openstack/contrib/scripts, which should put the appropriate
variables in place. Then, you will need to run the following playbooks:</p>
<p>/opt/rpc-openstack/openstack-ansible/playbooks/setup-everything.yml
/opt/rpc-openstack/rpcd/filebeat.yml</p>
<p>As long as all the playbooks run successfully, Magnum should now be
installed and running.</p>
</div>
<div class="section" id="installing-a-driver">
<h3>Installing a Driver<a class="headerlink" href="#installing-a-driver" title="Permalink to this headline">#</a></h3>
<p>In order to install (or update) a Magnum driver, you will need to use
the &#8216;install_driver.yml&#8217; playbook. You can find the documentation for
this playbook in &#8216;/rpc-setup/README.md&#8217;. This playbook will need to be
run from the Openstack deployment host, as it does rely on the OSA/RPC
inventory file.</p>
</div>
</div>
<div class="section" id="verification">
<h2>Verification<a class="headerlink" href="#verification" title="Permalink to this headline">#</a></h2>
<p>NOTE: Ensure that you have set your environment variables properly (e.g.
by using the &#8216;openrc&#8217; file) before attempting the following steps</p>
<p>The first step for verification is to ensure that the conductor services
are up and running. You can do this by running the following command
using the Python Magnum client (python-magnumclient):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">magnum</span> <span class="n">service</span><span class="o">-</span><span class="nb">list</span>
</pre></div>
</div>
<p>You should see something like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">+----+--------------+------------------+-------+----------+-----------------+---------------------------+---------------------------+</span>
<span class="o">|</span> <span class="nb">id</span> <span class="o">|</span> <span class="n">host</span>         <span class="o">|</span> <span class="n">binary</span>           <span class="o">|</span> <span class="n">state</span> <span class="o">|</span> <span class="n">disabled</span> <span class="o">|</span> <span class="n">disabled_reason</span> <span class="o">|</span> <span class="n">created_at</span>                <span class="o">|</span> <span class="n">updated_at</span>                <span class="o">|</span>
<span class="o">+----+--------------+------------------+-------+----------+-----------------+---------------------------+---------------------------+</span>
<span class="o">|</span> <span class="mi">1</span>  <span class="o">|</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.94</span> <span class="o">|</span> <span class="n">magnum</span><span class="o">-</span><span class="n">conductor</span> <span class="o">|</span> <span class="n">up</span>    <span class="o">|</span>          <span class="o">|</span> <span class="o">-</span>               <span class="o">|</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="n">T20</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span><span class="n">T17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">36</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>
<span class="o">+----+--------------+------------------+-------+----------+-----------------+---------------------------+---------------------------+</span>
</pre></div>
</div>
<p>If you see one entry per &#8216;control&#8217; node in the RPC cluster, all the
conductor services are up and running as expected.</p>
<p>The next step in verification is to create a Cluster Template and then
attempt to create a cluster based on that template. In order to do this,
please ensure that the following are true: * You have installed the
appropriate version of the Rackspace Managed Kubernetes driver</p>
<ul class="simple">
<li>You have the matching Rackspace Managed Kubernetes Fedora image in
Glance, and that the &#8216;os_distro&#8217; property matches the driver you
have installed.</li>
<li>You have a valid SSH key saved under the account you are using to
test</li>
<li>You have an external provider network set up in Openstack</li>
</ul>
<p>You can run the following command to set up a Magnum Cluster Template
for testing (be sure to fill in the command with appropriate values):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">magnum</span> <span class="n">cluster</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">dev</span> <span class="o">--</span><span class="n">image</span><span class="o">-</span><span class="nb">id</span> <span class="o">&lt;</span><span class="n">IMAGE_ID</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">external</span><span class="o">-</span><span class="n">network</span> <span class="o">&lt;</span><span class="n">EXTERNAL_NETWORK</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">coe</span> <span class="n">kubernetes</span>  <span class="o">--</span><span class="n">dns</span><span class="o">-</span><span class="n">nameserver</span> <span class="o">&lt;</span><span class="n">EXTERNAL_DNS</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">flavor</span><span class="o">-</span><span class="nb">id</span> <span class="n">m1</span><span class="o">.</span><span class="n">medium</span> <span class="o">--</span><span class="n">master</span><span class="o">-</span><span class="n">flavor</span><span class="o">-</span><span class="nb">id</span> <span class="n">m1</span><span class="o">.</span><span class="n">medium</span> <span class="o">--</span><span class="n">docker</span><span class="o">-</span><span class="n">volume</span><span class="o">-</span><span class="n">size</span> <span class="mi">20</span> <span class="o">--</span><span class="n">master</span><span class="o">-</span><span class="n">lb</span><span class="o">-</span><span class="n">enabled</span> <span class="o">--</span><span class="n">keypair</span><span class="o">-</span><span class="nb">id</span> <span class="o">&lt;</span><span class="n">KEYPAIR_NAME</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">label</span> <span class="n">master_anti_affinity</span><span class="o">=</span><span class="n">false</span> <span class="o">--</span><span class="n">label</span> <span class="n">number_of_masters</span><span class="o">=</span><span class="mi">3</span>
</pre></div>
</div>
<p>This command will set up a Cluster Template using the minimum worker and
master flavor sizes, as well as setting some sane default volume sizes.
Once you&#8217;ve created the Cluster Template, you can run the following
command to create a Kubernetes cluster:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">magnum</span> <span class="n">cluster</span><span class="o">-</span><span class="n">create</span> <span class="o">--</span><span class="n">cluster</span><span class="o">-</span><span class="n">template</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">dev</span> <span class="o">--</span><span class="n">name</span> <span class="o">&lt;</span><span class="n">CLUSTER_NAME</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">master</span><span class="o">-</span><span class="n">count</span> <span class="mi">3</span> <span class="o">--</span><span class="n">node</span><span class="o">-</span><span class="n">count</span> <span class="mi">3</span>
</pre></div>
</div>
<p>This will create a cluster with 3 master and 3 worker nodes, which will
ensure that the load balancing and clustering aspects of the master
nodes are functional. This can take up to 15 minutes to complete
successfully.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ha.html" class="btn btn-neutral float-right" title="High availability clusters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="logging.html" class="btn btn-neutral float-left" title="Magnum Centralized Logging" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Rackspace

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>